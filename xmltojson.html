<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Convertir XML a JSON</title>
</head>
<body>
  <h2>Convertidor XML a JSON</h2>
  <input type="file" id="xmlFile" accept=".xml" />
  <button onclick="convertirYDescargar()">Convertir y Descargar JSON</button>

  <script>
    function xmlToJson(xml) {
      const obj = {};
      if (xml.nodeType === 1 && xml.attributes.length > 0) {
        obj["@attributes"] = {};
        for (let j = 0; j < xml.attributes.length; j++) {
          const attribute = xml.attributes.item(j);
          obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
        }
      }

      if (xml.hasChildNodes()) {
        for (let i = 0; i < xml.childNodes.length; i++) {
          const item = xml.childNodes.item(i);
          const nodeName = item.nodeName;
          if (item.nodeType === 3 && item.nodeValue.trim()) {
            obj["#text"] = item.nodeValue.trim();
          } else {
            const childObj = xmlToJson(item);
            if (obj[nodeName] === undefined) {
              obj[nodeName] = childObj;
            } else {
              if (!Array.isArray(obj[nodeName])) {
                obj[nodeName] = [obj[nodeName]];
              }
              obj[nodeName].push(childObj);
            }
          }
        }
      }
      return obj;
    }

    function convertirYDescargar() {
      const archivo = document.getElementById("xmlFile").files[0];
      if (!archivo) {
        alert("Selecciona un archivo XML.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(e.target.result, "text/xml");
        const json = xmlToJson(xmlDoc);

        const blob = new Blob([JSON.stringify(json, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "convertido.json";
        a.click();
        URL.revokeObjectURL(url);
      };
      reader.readAsText(archivo);
    }
  </script>
</body>
</html>
